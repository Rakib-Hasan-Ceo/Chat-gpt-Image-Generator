<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat & Image Generator</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* --- CSS Variables --- */
        :root {
            --primary-gradient: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --accent-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --mk-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --shadow-premium: 0 20px 40px rgba(0, 0, 0, 0.1);
            --shadow-hover: 0 25px 50px rgba(0, 0, 0, 0.15);
            --border-radius: 20px;
            --border-radius-mobile: 16px;
            --animation-premium: cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* --- Reset and Base Styles --- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* --- Animated Background --- */
        .background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: linear-gradient(-45deg, #0f0c29, #302b63, #24243e, #1a1a2e);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        .particle {
            position: absolute;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            animation: float 20s infinite linear;
        }

        @keyframes float {
            0% { transform: translateY(0) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(-1000%) rotate(720deg); opacity: 0; }
        }

        /* --- Layout --- */
        .app-container {
            display: flex;
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            gap: 20px;
        }

        /* --- History Panel --- */
        .history-panel {
            width: 320px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-premium);
            padding: 25px;
            display: flex;
            flex-direction: column;
            transition: transform 0.4s var(--animation-premium);
            position: relative;
            overflow: hidden;
        }

        .history-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--mk-gradient);
            opacity: 0.05;
            z-index: -1;
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .history-header h2 {
            color: white;
            font-size: 1.5em;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .history-header h2 i {
            color: #667eea;
        }

        .clear-history {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 15px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .clear-history:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .history-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .history-tab {
            flex: 1;
            padding: 10px;
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .history-tab.active {
            background: var(--mk-gradient);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .history-list {
            flex-grow: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .history-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }

        .history-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-3px);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .history-item.active {
            background: rgba(102, 126, 234, 0.2);
            border-color: rgba(102, 126, 234, 0.5);
        }

        .history-preview {
            color: white;
            font-size: 0.9em;
            line-height: 1.4;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .history-date {
            font-size: 0.8em;
            color: rgba(255, 255, 255, 0.7);
            margin-top: 8px;
        }

        .history-empty {
            text-align: center;
            color: rgba(255, 255, 255, 0.7);
            padding: 40px 20px;
        }

        .history-empty i {
            font-size: 3em;
            margin-bottom: 15px;
            display: block;
            opacity: 0.5;
        }

        /* --- Main Content --- */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* --- Header --- */
        .header {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-premium);
            padding: 20px 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.6s var(--animation-premium);
        }

        .header:hover::before {
            left: 100%;
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .logo-icon {
            width: 60px;
            height: 60px;
            background: var(--mk-gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8em;
            color: white;
            box-shadow: var(--shadow-premium);
            animation: logoFloat 3s ease-in-out infinite;
        }

        @keyframes logoFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }

        .logo h1 {
            font-size: 2.8em;
            font-weight: 900;
            background: linear-gradient(135deg, #fff 0%, #f0f0f0 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 4px 8px rgba(0,0,0,0.3);
            letter-spacing: -1px;
        }

        .subtitle {
            font-size: 1.2em;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 400;
            margin-bottom: 15px;
        }

        .premium-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: var(--mk-gradient);
            padding: 8px 20px;
            border-radius: 25px;
            color: white;
            font-weight: 600;
            font-size: 14px;
            box-shadow: var(--shadow-premium);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* --- Mode Toggle --- */
        .mode-toggle-container {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        .mode-toggle {
            display: flex;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 50px;
            padding: 6px;
            box-shadow: var(--shadow-premium);
            position: relative;
            overflow: hidden;
        }

        .mode-toggle::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.6s var(--animation-premium);
        }

        .mode-toggle:hover::before {
            left: 100%;
        }

        .mode-option {
            padding: 12px 25px;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s var(--animation-premium);
            font-weight: 600;
            color: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            gap: 8px;
            position: relative;
            z-index: 1;
        }

        .mode-option.active {
            background: var(--mk-gradient);
            color: white;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .mode-option:not(.active):hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        /* --- Content Area --- */
        .content-area {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            flex-grow: 1;
        }

        .mode-chat .image-generator {
            display: none;
        }

        .mode-image .chat-container {
            display: none;
        }

        /* --- Chat Container --- */
        .chat-container {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-premium);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            height: 600px;
            transition: all 0.4s var(--animation-premium);
            position: relative;
        }

        .chat-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 2px;
            background: var(--mk-gradient);
            transition: left 0.6s var(--animation-premium);
        }

        .chat-container:hover::before {
            left: 0;
        }

        .chat-container:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-hover);
        }

        .chat-header {
            background: var(--primary-gradient);
            color: white;
            padding: 18px 25px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .chat-header h2 {
            margin: 0;
            font-size: 1.9em;
            font-weight: 600;
        }
        .chat-header p {
            margin: 5px 0 0;
            font-size: 0.9em;
            opacity: 0.9;
        }

        .chat-box {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
            background-color: rgba(255, 255, 255, 0.05);
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .message {
            padding: 12px 18px;
            border-radius: 20px;
            line-height: 1.5;
            max-width: 80%;
            word-wrap: break-word;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            position: relative;
        }

        .user-message {
            background: var(--primary-gradient);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 5px;
        }

        .ai-message {
            background-color: rgba(255, 255, 255, 0.15);
            color: white;
            align-self: flex-start;
            border-bottom-left-radius: 5px;
        }

        .ai-message em {
            color: rgba(255, 255, 255, 0.8);
            font-style: italic;
        }

        .input-area {
            display: flex;
            padding: 15px 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            background-color: rgba(255, 255, 255, 0.05);
        }

        #user-input {
            flex-grow: 1;
            padding: 14px 18px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 30px;
            margin-right: 12px;
            font-size: 1.05em;
            outline: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }

        #user-input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        #user-input:focus {
            border-color: rgba(255, 255, 255, 0.6);
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.2);
        }

        #send-button {
            padding: 0 25px;
            background: var(--primary-gradient);
            color: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        #send-button:hover {
            opacity: 0.9;
        }
        #send-button:active {
            transform: scale(0.97);
        }

        .chat-footer {
            text-align: center;
            padding: 10px;
            font-size: 0.8em;
            color: rgba(255, 255, 255, 0.7);
            background-color: rgba(255, 255, 255, 0.05);
        }

        /* --- Image Generator --- */
        .image-generator {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow-premium);
            transition: all 0.4s var(--animation-premium);
            position: relative;
            overflow: hidden;
        }

        .image-generator::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 2px;
            background: var(--mk-gradient);
            transition: left 0.6s var(--animation-premium);
        }

        .image-generator:hover::before {
            left: 0;
        }

        .image-generator:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-hover);
        }

        .section-title {
            font-size: 1.3em;
            font-weight: 700;
            color: white;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title i {
            color: #667eea;
        }

        /* Quality Selection */
        .quality-selector {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .quality-selector:hover {
            border-color: var(--glass-border);
            transform: translateY(-2px);
        }

        .quality-selector label {
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 12px;
            display: block;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .quality-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        @media (min-width: 768px) {
            .quality-options {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        .quality-option {
            padding: 12px 16px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s var(--animation-premium);
            font-size: 12px;
            font-weight: 600;
            text-align: center;
            position: relative;
            overflow: hidden;
            color: white;
        }

        .quality-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: var(--mk-gradient);
            transition: left 0.3s ease;
            z-index: -1;
        }

        .quality-option:hover::before {
            left: 0;
        }

        .quality-option:hover {
            color: white;
            border-color: transparent;
            transform: translateY(-2px);
        }

        .quality-option.active {
            background: var(--mk-gradient);
            color: white;
            border-color: transparent;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .quality-option.active::before {
            left: 0;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .form-input {
            width: 100%;
            padding: 15px 18px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.1);
            font-family: inherit;
            resize: vertical;
            color: white;
        }

        .form-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .form-input:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.5);
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.1);
        }

        .char-counter {
            text-align: right;
            margin-top: 5px;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        .form-select {
            width: 100%;
            padding: 15px 18px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            font-size: 16px;
            background: rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            -webkit-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23ffffff'%3E%3Cpath d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 20px;
            color: white;
        }

        .form-select:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.5);
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.1);
        }

        .form-select option {
            background: #333;
            color: white;
        }

        /* Buttons */
        .btn {
            padding: 15px 25px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s var(--animation-premium);
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
            width: 100%;
            margin-bottom: 12px;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.2) 50%, rgba(255,255,255,0.1) 100%);
            transition: left 0.5s ease;
            z-index: 1;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn span {
            position: relative;
            z-index: 2;
        }

        .btn-primary {
            background: var(--mk-gradient);
            color: white;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: var(--secondary-gradient);
            color: white;
            box-shadow: 0 8px 25px rgba(240, 147, 251, 0.3);
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(240, 147, 251, 0.4);
        }

        .btn-accent {
            background: var(--accent-gradient);
            color: white;
            box-shadow: 0 8px 25px rgba(79, 172, 254, 0.3);
        }

        .btn-accent:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(79, 172, 254, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Button Grid */
        .button-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 15px;
        }

        /* Loading Animation */
        .loading-container {
            text-align: center;
            padding: 40px 20px;
            color: white;
            display: none;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-top: 4px solid #4facfe;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 25px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 15px;
            color: #fff;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: var(--mk-gradient);
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 3px;
        }

        .progress-status {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.8);
            text-align: center;
        }

        /* Image Display */
        .image-container {
            display: none;
            text-align: center;
            color: white;
        }

        .generated-image {
            max-width: 100%;
            height: auto;
            border-radius: var(--border-radius-mobile);
            box-shadow: var(--shadow-premium);
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .generated-image:hover {
            transform: scale(1.02);
            box-shadow: var(--shadow-hover);
        }

        .image-info {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: left;
        }

        .image-info h3 {
            color: #fff;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .image-info p {
            color: rgba(255, 255, 255, 0.9);
            margin: 5px 0;
            font-size: 14px;
        }

        .image-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 20px;
        }

        @media (min-width: 768px) {
            .image-actions {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        .image-actions .btn {
            width: 100%;
            padding: 12px 16px;
            font-size: 14px;
            margin-bottom: 0;
        }

        /* Placeholder */
        .placeholder {
            text-align: center;
            padding: 60px 20px;
            color: rgba(255, 255, 255, 0.8);
        }

        .placeholder i {
            font-size: 3.5em;
            margin-bottom: 20px;
            display: block;
            opacity: 0.5;
        }

        .placeholder h3 {
            font-size: 1.8em;
            margin-bottom: 15px;
            color: #fff;
        }

        .placeholder p {
            font-size: 1.1em;
            line-height: 1.6;
        }

        /* Scrollbar Styling */
        .chat-box::-webkit-scrollbar,
        .history-list::-webkit-scrollbar {
            width: 8px;
        }
        .chat-box::-webkit-scrollbar-track,
        .history-list::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        .chat-box::-webkit-scrollbar-thumb,
        .history-list::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
        }
        .chat-box::-webkit-scrollbar-thumb:hover,
        .history-list::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            position: relative;
            max-width: 90vw;
            max-height: 90vh;
        }

        .modal img {
            max-width: 100%;
            max-height: 90vh;
            border-radius: 10px;
        }

        .close-modal {
            position: absolute;
            top: -40px;
            right: -10px;
            background: none;
            border: none;
            color: white;
            font-size: 2.5em;
            cursor: pointer;
            z-index: 1001;
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            left: 20px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 15px;
            z-index: 1000;
            animation: slideInMobile 0.3s ease;
        }

        @keyframes slideInMobile {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .notification-content {
            display: flex;
            align-items: center;
            gap: 12px;
            color: white;
            font-size: 14px;
        }

        .notification i {
            font-size: 1.3em;
        }

        .notification.success {
            border-color: #10dc60;
            background: rgba(16, 220, 96, 0.1);
        }

        .notification.error {
            border-color: #ff4757;
            background: rgba(255, 71, 87, 0.1);
        }

        .close-notification {
            background: none;
            border: none;
            color: white;
            font-size: 1.3em;
            cursor: pointer;
            margin-left: auto;
            padding: 5px;
        }

        /* Mobile Panel Toggle */
        .panel-toggle {
            display: none;
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 100;
            background: var(--mk-gradient);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 1.5em;
            cursor: pointer;
            box-shadow: var(--shadow-premium);
            transition: all 0.3s ease;
        }

        .panel-toggle:hover {
            transform: scale(1.1);
        }

        /* Desktop Responsive Design */
        @media (min-width: 768px) {
            .app-container {
                padding: 30px;
            }

            .logo h1 {
                font-size: 3.5em;
            }

            .subtitle {
                font-size: 1.4em;
            }

            .notification {
                left: auto;
                max-width: 400px;
                right: 30px;
                top: 30px;
            }

            .notification-content {
                font-size: 16px;
            }

            @keyframes slideInMobile {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
        }

        /* Mobile Responsive */
        @media (max-width: 1024px) {
            .app-container {
                flex-direction: column;
            }
            
            .history-panel {
                width: 100%;
                transform: translateX(-100%);
                position: fixed;
                top: 0;
                left: 0;
                height: 100%;
                z-index: 99;
                border-radius: 0;
            }
            
            .history-panel.active {
                transform: translateX(0);
            }
            
            .panel-toggle {
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .main-content {
                width: 100%;
            }
        }

        /* Touch Optimizations */
        @media (hover: none) {
            .chat-container:hover, .image-generator:hover {
                transform: none;
            }
            
            .btn:hover {
                transform: none;
            }
        }
    </style>
</head>
<body>
    <!-- Animated Background -->
    <div class="background">
        <div class="particles" id="particles"></div>
    </div>

    <!-- Mobile Panel Toggle -->
    <button class="panel-toggle" id="panelToggle">
        <i class="fas fa-history"></i>
    </button>

    <div class="app-container">
        <!-- History Panel -->
        <div class="history-panel" id="historyPanel">
            <div class="history-header">
                <h2><i class="fas fa-history"></i> History</h2>
                <button class="clear-history" id="clearHistory">Clear</button>
            </div>
            
            <div class="history-tabs">
                <div class="history-tab active" data-type="all">All</div>
                <div class="history-tab" data-type="chat">Chat</div>
                <div class="history-tab" data-type="image">Images</div>
            </div>
            
            <div class="history-list" id="historyList">
                <div class="history-empty">
                    <i class="fas fa-inbox"></i>
                    <h3>No History Yet</h3>
                    <p>Your chat and image generation history will appear here</p>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <header class="header">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-robot"></i>
                    </div>
                    <h1>Chat AI</h1>
                </div>
                <p class="subtitle">Advanced Chat & Image Generation Platform</p>
                <div class="premium-badge">
                    <i class="fas fa-crown"></i>
                    AI Edition
                </div>
            </header>

            <!-- Mode Toggle -->
            <div class="mode-toggle-container">
                <div class="mode-toggle">
                    <div class="mode-option active" data-mode="chat">
                        <i class="fas fa-comments"></i>
                        AI Chat
                    </div>
                    <div class="mode-option" data-mode="image">
                        <i class="fas fa-image"></i>
                        Image Generator
                    </div>
                </div>
            </div>

            <!-- Content Area -->
            <div class="content-area mode-chat" id="contentArea">
                <!-- Chat Section -->
                <div class="chat-container">
                    <div class="chat-header">
                        <h2>Chat AI</h2>
                        <p>Ask me anything - I'm Made By Rakib Hasan 💖</p>
                    </div>
                    <div id="chat-box" class="chat-box">
                        <!-- Initial AI Message -->
                        <div class="message ai-message">
                            Hello! I'm your Chat AI assistant. I can answer questions, generate images, and help with creative tasks. What would you like to explore today?
                        </div>
                    </div>
                    <div class="input-area">
                        <input type="text" id="user-input" placeholder="Ask me anything or describe an image to generate...">
                        <button id="send-button" title="Send">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-send-fill" viewBox="0 0 16 16">
                              <path d="M15.964.686a.5.5 0 0 0-.65-.65L.767 5.855H.766l-.452.18a.5.5 0 0 0-.082.887l.41.26.001.002 4.995 3.178 3.178 4.995.002.002.26.41a.5.5 0 0 0 .886-.083l6-15Zm-1.833 1.89L6.637 10.07l-.215-.338a.5.5 0 0 0-.154-.154l-.338-.215 7.494-7.494 1.178-.471-.47 1.178Z"/>
                            </svg>
                        </button>
                    </div>
                    <div class="chat-footer">
                        Made By Rakib Hasan 💖 | Powered By AI
                    </div>
                </div>

                <!-- Image Generator Section -->
                <div class="image-generator">
                    <div class="section-title">
                        <i class="fas fa-image"></i>
                        AI Image Generator
                    </div>

                    <!-- Quality Selection -->
                    <div class="quality-selector">
                        <label>Generation Quality</label>
                        <div class="quality-options">
                            <div class="quality-option active" data-quality="ultra">🚀 Quantum</div>
                            <div class="quality-option" data-quality="pro">💎 Neural</div>
                            <div class="quality-option" data-quality="premium">⭐ Premium</div>
                            <div class="quality-option" data-quality="standard">🎨 Standard</div>
                        </div>
                    </div>

                    <!-- Prompt Input -->
                    <div class="form-group">
                        <label for="promptInput">Image Description</label>
                        <textarea 
                            id="promptInput" 
                            class="form-input" 
                            rows="4" 
                            placeholder="Describe your vision in detail... Be creative and specific!"
                            maxlength="1000"
                        ></textarea>
                        <div class="char-counter">
                            <span id="charCount">0</span> / 1000 characters
                        </div>
                    </div>

                    <!-- Style Selection -->
                    <div class="form-group">
                        <label for="styleSelect">Art Style</label>
                        <select id="styleSelect" class="form-select">
                            <option value="photorealistic">📸 Photorealistic</option>
                            <option value="artistic">🎨 Artistic</option>
                            <option value="anime">🌸 Anime</option>
                            <option value="digital art">💻 Digital Art</option>
                            <option value="oil painting">🖼️ Oil Painting</option>
                            <option value="watercolor">🎭 Watercolor</option>
                            <option value="sketch">✏️ Sketch</option>
                            <option value="cyberpunk">🤖 Cyberpunk</option>
                            <option value="fantasy">🧚 Fantasy</option>
                            <option value="minimalist">⚡ Minimalist</option>
                        </select>
                    </div>

                    <!-- Size Selection -->
                    <div class="form-group">
                        <label for="sizeSelect">Image Size</label>
                        <select id="sizeSelect" class="form-select">
                            <option value="1024x1024">🟨 Square (1024×1024)</option>
                            <option value="1024x768">📱 Landscape (1024×768)</option>
                            <option value="768x1024">📐 Portrait (768×1024)</option>
                            <option value="1280x720">🖥️ HD (1280×720)</option>
                            <option value="1920x1080">📺 Full HD (1920×1080)</option>
                        </select>
                    </div>

                    <!-- Action Buttons -->
                    <button id="generateBtn" class="btn btn-primary">
                        <span><i class="fas fa-magic"></i> Generate Image</span>
                    </button>

                    <div class="button-grid">
                        <button id="inspirationBtn" class="btn btn-secondary">
                            <span><i class="fas fa-lightbulb"></i> Inspire</span>
                        </button>
                        <button id="enhanceBtn" class="btn btn-accent">
                            <span><i class="fas fa-wand-magic-sparkles"></i> Enhance</span>
                        </button>
                    </div>

                    <!-- Loading State -->
                    <div id="loadingContainer" class="loading-container">
                        <div class="loading-spinner"></div>
                        <div class="loading-text">Quantum AI Creation...</div>
                        <div class="progress-bar">
                            <div id="progressFill" class="progress-fill"></div>
                        </div>
                        <div id="progressStatus" class="progress-status">Processing your vision...</div>
                    </div>

                    <!-- Placeholder -->
                    <div id="placeholder" class="placeholder">
                        <i class="fas fa-paint-brush"></i>
                        <h3>Ready to Create</h3>
                        <p>Enter your creative vision and watch as Quantum AI brings it to life with stunning quality.</p>
                    </div>

                    <!-- Generated Image -->
                    <div id="imageContainer" class="image-container">
                        <img id="generatedImage" class="generated-image" alt="Generated artwork" crossorigin="anonymous" />
                        
                        <div class="image-info">
                            <h3>✨ Creation Details</h3>
                            <p><strong>Prompt:</strong> <span id="usedPrompt">-</span></p>
                            <p><strong>Quality:</strong> <span id="usedQuality">-</span></p>
                            <p><strong>Powered by:</strong> Quantum Neural Networks</p>
                        </div>

                        <div class="image-actions">
                            <button id="downloadBtn" class="btn btn-primary">
                                <span><i class="fas fa-download"></i> Save</span>
                            </button>
                            <button id="fullscreenBtn" class="btn btn-accent">
                                <span><i class="fas fa-expand"></i> View</span>
                            </button>
                            <button id="regenerateBtn" class="btn btn-secondary">
                                <span><i class="fas fa-redo"></i> Retry</span>
                            </button>
                            <button id="shareBtn" class="btn btn-accent">
                                <span><i class="fas fa-share"></i> Share</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for fullscreen image view -->
    <div class="modal" id="imageModal" style="display: none;">
        <div class="modal-content">
            <button class="close-modal" id="closeModal">&times;</button>
            <img id="modalImage" alt="Fullscreen image" />
        </div>
    </div>

    <!-- Notification system -->
    <div class="notification" id="notification" style="display: none;">
        <div class="notification-content">
            <i class="fas fa-exclamation-triangle"></i>
            <span id="notificationText"></span>
            <button class="close-notification" id="closeNotification">&times;</button>
        </div>
    </div>

    <script>
        // AI Assistant Application
        class AIAssistant {
            constructor() {
                this.initializeElements();
                this.bindEvents();
                this.selectedQuality = 'ultra';
                this.currentImageData = null;
                this.typingIndicator = null;
                this.currentMode = 'chat';
                this.history = JSON.parse(localStorage.getItem('aiAssistantHistory')) || [];
                this.activeHistoryType = 'all';
                
                // Hidden API Configuration
                this.apiMapping = {
                    ultra: 'stablecog',
                    pro: 'pollinations',
                    premium: 'pixabay',
                    standard: 'unsplash'
                };

                this.apiKeys = {
                    stablecog: 'your_api_key',
                    pollinations: '',
                    pixabay: 'your_pixabay_key',
                    unsplash: 'your_unsplash_key'
                };

                this.createParticles();
                this.showWelcomeMessage();
                this.renderHistory();
            }

            initializeElements() {
                // Chat elements
                this.chatBox = document.getElementById('chat-box');
                this.userInput = document.getElementById('user-input');
                this.sendButton = document.getElementById('send-button');
                
                // Image generator elements
                this.promptInput = document.getElementById('promptInput');
                this.charCount = document.getElementById('charCount');
                this.styleSelect = document.getElementById('styleSelect');
                this.sizeSelect = document.getElementById('sizeSelect');
                this.generateBtn = document.getElementById('generateBtn');
                this.inspirationBtn = document.getElementById('inspirationBtn');
                this.enhanceBtn = document.getElementById('enhanceBtn');
                this.loadingContainer = document.getElementById('loadingContainer');
                this.imageContainer = document.getElementById('imageContainer');
                this.placeholder = document.getElementById('placeholder');
                this.generatedImage = document.getElementById('generatedImage');
                this.usedPrompt = document.getElementById('usedPrompt');
                this.usedQuality = document.getElementById('usedQuality');
                this.progressFill = document.getElementById('progressFill');
                this.progressStatus = document.getElementById('progressStatus');
                this.downloadBtn = document.getElementById('downloadBtn');
                this.fullscreenBtn = document.getElementById('fullscreenBtn');
                this.regenerateBtn = document.getElementById('regenerateBtn');
                this.shareBtn = document.getElementById('shareBtn');
                this.qualityOptions = document.querySelectorAll('.quality-option');
                
                // Mode toggle elements
                this.modeOptions = document.querySelectorAll('.mode-option');
                this.contentArea = document.getElementById('contentArea');
                
                // History elements
                this.historyPanel = document.getElementById('historyPanel');
                this.historyList = document.getElementById('historyList');
                this.historyTabs = document.querySelectorAll('.history-tab');
                this.clearHistoryBtn = document.getElementById('clearHistory');
                this.panelToggle = document.getElementById('panelToggle');
                
                // Modal and notification elements
                this.imageModal = document.getElementById('imageModal');
                this.modalImage = document.getElementById('modalImage');
                this.closeModal = document.getElementById('closeModal');
                this.notification = document.getElementById('notification');
                this.notificationText = document.getElementById('notificationText');
                this.closeNotification = document.getElementById('closeNotification');
            }

            bindEvents() {
                // Chat events
                this.sendButton.addEventListener('click', () => this.handleSendMessage());
                this.userInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        this.handleSendMessage();
                    }
                });

                // Image generator events
                this.promptInput.addEventListener('input', () => this.updateCharCount());
                this.qualityOptions.forEach(option => {
                    option.addEventListener('click', () => this.selectQuality(option));
                });
                this.generateBtn.addEventListener('click', () => this.generateImage());
                this.inspirationBtn.addEventListener('click', () => this.getInspiration());
                this.enhanceBtn.addEventListener('click', () => this.enhancePrompt());
                this.downloadBtn.addEventListener('click', () => this.downloadImage());
                this.fullscreenBtn.addEventListener('click', () => this.showFullscreen());
                this.regenerateBtn.addEventListener('click', () => this.regenerateImage());
                this.shareBtn.addEventListener('click', () => this.shareImage());

                // Mode toggle events
                this.modeOptions.forEach(option => {
                    option.addEventListener('click', () => this.selectMode(option));
                });

                // History events
                this.historyTabs.forEach(tab => {
                    tab.addEventListener('click', () => this.selectHistoryTab(tab));
                });
                this.clearHistoryBtn.addEventListener('click', () => this.clearHistory());
                this.panelToggle.addEventListener('click', () => this.toggleHistoryPanel());

                // Modal and notification events
                this.closeModal.addEventListener('click', () => this.hideModal());
                this.imageModal.addEventListener('click', (e) => {
                    if (e.target === this.imageModal) {
                        this.hideModal();
                    }
                });
                this.closeNotification.addEventListener('click', () => this.hideNotification());

                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        this.hideModal();
                        this.hideNotification();
                        this.hideHistoryPanel();
                    }
                });
            }

            // History functionality
            addToHistory(type, content, data = null) {
                const historyItem = {
                    id: Date.now(),
                    type,
                    content,
                    data,
                    timestamp: new Date().toISOString(),
                    preview: content.length > 100 ? content.substring(0, 100) + '...' : content
                };
                
                this.history.unshift(historyItem);
                if (this.history.length > 50) {
                    this.history = this.history.slice(0, 50);
                }
                
                this.saveHistory();
                this.renderHistory();
            }

            saveHistory() {
                localStorage.setItem('aiAssistantHistory', JSON.stringify(this.history));
            }

            clearHistory() {
                if (confirm('Are you sure you want to clear all history?')) {
                    this.history = [];
                    this.saveHistory();
                    this.renderHistory();
                    this.showNotification('🗑️ History cleared', 'success');
                }
            }

            renderHistory() {
                if (this.history.length === 0) {
                    this.historyList.innerHTML = `
                        <div class="history-empty">
                            <i class="fas fa-inbox"></i>
                            <h3>No History Yet</h3>
                            <p>Your chat and image generation history will appear here</p>
                        </div>
                    `;
                    return;
                }

                const filteredHistory = this.activeHistoryType === 'all' 
                    ? this.history 
                    : this.history.filter(item => item.type === this.activeHistoryType);

                this.historyList.innerHTML = filteredHistory.map(item => `
                    <div class="history-item" data-id="${item.id}">
                        <div class="history-preview">
                            <strong>${item.type === 'chat' ? '💬' : '🖼️'} ${item.type.charAt(0).toUpperCase() + item.type.slice(1)}</strong><br>
                            ${item.preview}
                        </div>
                        <div class="history-date">
                            ${new Date(item.timestamp).toLocaleString()}
                        </div>
                    </div>
                `).join('');

                // Add click events to history items
                this.historyList.querySelectorAll('.history-item').forEach(item => {
                    item.addEventListener('click', () => {
                        const id = parseInt(item.dataset.id);
                        const historyItem = this.history.find(h => h.id === id);
                        if (historyItem) {
                            this.loadHistoryItem(historyItem);
                        }
                    });
                });
            }

            loadHistoryItem(item) {
                if (item.type === 'chat') {
                    this.selectMode(document.querySelector('.mode-option[data-mode="chat"]'));
                    this.addMessage(item.content, 'user');
                    this.showNotification('📝 Chat loaded from history', 'success');
                } else if (item.type === 'image') {
                    this.selectMode(document.querySelector('.mode-option[data-mode="image"]'));
                    this.promptInput.value = item.content;
                    this.updateCharCount();
                    if (item.data && item.data.imageUrl) {
                        this.displayGeneratedImage(item.data.imageUrl, item.content);
                    }
                    this.showNotification('🖼️ Image prompt loaded from history', 'success');
                }
                
                // Close history panel on mobile
                if (window.innerWidth <= 1024) {
                    this.hideHistoryPanel();
                }
            }

            selectHistoryTab(tab) {
                this.historyTabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                this.activeHistoryType = tab.dataset.type;
                this.renderHistory();
            }

            toggleHistoryPanel() {
                this.historyPanel.classList.toggle('active');
            }

            hideHistoryPanel() {
                this.historyPanel.classList.remove('active');
            }

            // Mode toggle functionality
            selectMode(selectedOption) {
                this.modeOptions.forEach(option => option.classList.remove('active'));
                selectedOption.classList.add('active');
                this.currentMode = selectedOption.dataset.mode;
                
                // Update the content area class to show/hide sections
                this.contentArea.className = `content-area mode-${this.currentMode}`;
                
                const modeName = selectedOption.textContent.trim();
                this.showNotification(`🔄 Switched to ${modeName}`, 'success');
            }

            // Chat functionality
            addMessage(text, sender) {
                this.removeTypingIndicator();

                const messageDiv = document.createElement('div');
                messageDiv.classList.add('message', `${sender}-message`);
                messageDiv.textContent = text;
                this.chatBox.appendChild(messageDiv);

                this.chatBox.scrollTo({ top: this.chatBox.scrollHeight, behavior: 'smooth' });

                // Add to history if it's a user message
                if (sender === 'user') {
                    this.addToHistory('chat', text);
                }
            }

            showTypingIndicator() {
                if (this.typingIndicator) return;
                this.typingIndicator = document.createElement('div');
                this.typingIndicator.classList.add('message', 'ai-message');
                this.typingIndicator.innerHTML = '<em>Quantum AI is thinking...</em>';
                this.chatBox.appendChild(this.typingIndicator);
                this.chatBox.scrollTo({ top: this.chatBox.scrollHeight, behavior: 'smooth' });
            }

            removeTypingIndicator() {
                if (this.typingIndicator && this.chatBox.contains(this.typingIndicator)) {
                    this.chatBox.removeChild(this.typingIndicator);
                    this.typingIndicator = null;
                }
            }

            async handleSendMessage() {
                const userText = this.userInput.value.trim();
                if (userText === '') return;

                this.addMessage(userText, 'user');
                this.userInput.value = '';
                this.userInput.focus();

                // Check if the message is asking for an image
                if (this.isImageRequest(userText)) {
                    this.addMessage("I'll generate an image for you based on your description.", 'ai');
                    const imagePrompt = this.extractImagePrompt(userText);
                    this.promptInput.value = imagePrompt;
                    this.updateCharCount();
                    await this.generateImage();
                } else {
                    this.showTypingIndicator();
                    await this.getApiResponse(userText);
                }
            }

            isImageRequest(text) {
                const imageKeywords = [
                    'generate', 'create', 'make', 'show', 'draw', 'picture', 'image', 
                    'photo', 'art', 'illustration', 'visual', 'graphic'
                ];
                return imageKeywords.some(keyword => 
                    text.toLowerCase().includes(keyword)
                );
            }

            extractImagePrompt(text) {
                // Simple extraction - in a real app, you'd use more sophisticated NLP
                const imageKeywords = [
                    'generate', 'create', 'make', 'show', 'draw'
                ];
                
                for (const keyword of imageKeywords) {
                    if (text.toLowerCase().includes(keyword)) {
                        return text.substring(text.toLowerCase().indexOf(keyword) + keyword.length).trim();
                    }
                }
                
                return text;
            }

            // Image Generator functionality
            selectQuality(selectedOption) {
                this.qualityOptions.forEach(option => option.classList.remove('active'));
                selectedOption.classList.add('active');
                this.selectedQuality = selectedOption.dataset.quality;
                
                const qualityName = selectedOption.textContent;
                this.showNotification(`✨ Quality set to ${qualityName}`, 'success');
            }

            updateCharCount() {
                const count = this.promptInput.value.length;
                this.charCount.textContent = count;
                
                if (count > 800) {
                    this.charCount.style.color = '#ff4757';
                } else if (count > 600) {
                    this.charCount.style.color = '#ffa726';
                } else {
                    this.charCount.style.color = 'rgba(255, 255, 255, 0.7)';
                }
            }

            getInspiration() {
                const premiumPrompts = [
                    "A majestic dragon soaring over mystical floating islands with waterfalls",
                    "Futuristic cyberpunk cityscape at night with neon holographic advertisements",
                    "Enchanted forest clearing with luminescent mushrooms and fairy lights",
                    "Victorian steampunk laboratory with brass instruments and glowing Tesla coils",
                    "Serene Japanese zen garden with cherry blossoms and koi pond",
                    "Massive space station orbiting a ringed planet with distant galaxies",
                    "Underwater coral palace with mermaids and bioluminescent sea creatures",
                    "Medieval castle on cliff during dramatic lightning storm",
                    "Cozy wizard's study with floating books and magical artifacts",
                    "Post-apocalyptic desert landscape with ancient ruins and lone traveler",
                    "Crystal cave illuminated by ethereal rainbow light reflections",
                    "Vintage 1920s art deco ballroom with elegant dancers",
                    "Surreal Salvador Dali dreamscape with melting clocks",
                    "Nordic fjord with dramatic mountains and aurora borealis",
                    "Cybernetic android artist painting in high-tech studio",
                    "Tropical paradise island with crystal clear waters and palm trees"
                ];
                
                const randomPrompt = premiumPrompts[Math.floor(Math.random() * premiumPrompts.length)];
                this.promptInput.value = randomPrompt;
                this.updateCharCount();
                this.showNotification('🎨 Premium inspiration loaded!', 'success');
            }

            enhancePrompt() {
                const currentPrompt = this.promptInput.value.trim();
                if (!currentPrompt) {
                    this.showNotification('⚠️ Please enter a prompt first to enhance', 'error');
                    return;
                }

                const enhancements = [
                    ", highly detailed, 8k resolution, professional photography",
                    ", masterpiece quality, dramatic lighting, cinematic composition",
                    ", ultra-realistic, sharp focus, vibrant colors, award-winning",
                    ", studio lighting, perfect composition, trending on artstation",
                    ", hyperrealistic, bokeh background, golden hour lighting"
                ];

                const randomEnhancement = enhancements[Math.floor(Math.random() * enhancements.length)];
                this.promptInput.value = currentPrompt + randomEnhancement;
                this.updateCharCount();
                this.showNotification('✨ Prompt enhanced for premium quality!', 'success');
            }

            async generateImage() {
                const prompt = this.promptInput.value.trim();
                
                if (!prompt) {
                    this.showNotification('⚠️ Please enter a description for your image', 'error');
                    return;
                }

                if (prompt.length < 5) {
                    this.showNotification('⚠️ Please provide a more detailed description (minimum 5 characters)', 'error');
                    return;
                }

                this.setLoadingState(true);
                this.hideElements();
                this.loadingContainer.style.display = 'block';
                
                try {
                    await this.simulateImageGeneration();
                    const imageUrl = await this.generateRealImage(prompt);
                    
                    this.displayGeneratedImage(imageUrl, prompt);
                    this.showNotification('🎉 Quantum image created successfully!', 'success');
                    
                    // Add to history
                    this.addToHistory('image', prompt, {
                        imageUrl: imageUrl,
                        quality: this.selectedQuality,
                        style: this.styleSelect.value,
                        size: this.sizeSelect.value
                    });
                    
                } catch (error) {
                    console.error('Error generating image:', error);
                    this.showNotification('❌ Generation failed. Please try again.', 'error');
                    this.showPlaceholder();
                } finally {
                    this.setLoadingState(false);
                }
            }

            async simulateImageGeneration() {
                const quality = this.selectedQuality;
                const steps = quality === 'ultra' ? [
                    { progress: 15, message: 'Initializing Quantum AI Engine...', status: 'Loading neural models' },
                    { progress: 30, message: 'Processing with quantum algorithms...', status: 'Analyzing creative vision' },
                    { progress: 50, message: 'Quantum AI generating masterpiece...', status: 'Creating high-dimensional art' },
                    { progress: 70, message: 'Applying quantum enhancements...', status: 'Refining quantum details' },
                    { progress: 85, message: 'Finalizing quantum quality...', status: 'Professional quantum finishing' },
                    { progress: 95, message: 'Almost ready...', status: 'Quantum entanglement complete' },
                    { progress: 100, message: 'Quantum creation complete!', status: 'Ready to view' }
                ] : [
                    { progress: 10, message: 'Connecting to Quantum AI...', status: 'Establishing quantum connection' },
                    { progress: 25, message: 'Processing your vision...', status: 'Understanding quantum requirements' },
                    { progress: 45, message: 'Quantum AI creating your image...', status: 'Generating quantum artwork' },
                    { progress: 65, message: 'Applying style and details...', status: 'Adding quantum finishing touches' },
                    { progress: 80, message: 'Enhancing image quality...', status: 'Quantum quality improvement' },
                    { progress: 95, message: 'Almost ready...', status: 'Final quantum processing' },
                    { progress: 100, message: 'Quantum creation complete!', status: 'Ready!' }
                ];

                for (const step of steps) {
                    await new Promise(resolve => setTimeout(resolve, quality === 'ultra' ? 1200 : 900));
                    this.progressFill.style.width = step.progress + '%';
                    document.querySelector('.loading-text').textContent = step.message;
                    this.progressStatus.textContent = step.status;
                }
            }

            async generateRealImage(prompt) {
                const style = this.styleSelect.value;
                const enhancedPrompt = style !== 'photorealistic' ? 
                    `${prompt}, ${style} style` : prompt;

                // Map quality to hidden API
                const selectedApi = this.apiMapping[this.selectedQuality];

                switch (selectedApi) {
                    case 'stablecog':
                        return await this.generateStablecogImage(enhancedPrompt);
                    case 'pollinations':
                        return await this.generatePollinationsImage(enhancedPrompt);
                    case 'pixabay':
                        return await this.searchPixabayImage(prompt);
                    case 'unsplash':
                        return await this.searchUnsplashImage(prompt);
                    default:
                        throw new Error('Unknown generation engine');
                }
            }

            async generateStablecogImage(prompt) {
                const apiKey = this.apiKeys.stablecog;
                const size = this.sizeSelect.value;

                const requestBody = {
                    prompt: prompt + ", professional quality, detailed, high resolution",
                    negative_prompt: "blurry, bad quality, low quality, distorted, ugly, disfigured, low resolution",
                    width: size.includes('x') ? parseInt(size.split('x')[0]) : parseInt(size),
                    height: size.includes('x') ? parseInt(size.split('x')[1]) : parseInt(size),
                    num_inference_steps: 35,
                    guidance_scale: 8.0,
                    seed: Math.floor(Math.random() * 999999999),
                    num_outputs: 1
                };

                try {
                    const response = await fetch('https://api.stablecog.com/v1/image/generation/create', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${apiKey}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(requestBody)
                    });

                    if (!response.ok) {
                        throw new Error(`API error: ${response.status}`);
                    }

                    const data = await response.json();
                    
                    if (data.image_url) {
                        return data.image_url;
                    } else if (data.outputs && data.outputs.length > 0) {
                        return data.outputs[0].image_url || data.outputs[0].url;
                    } else if (data.images && data.images.length > 0) {
                        return data.images[0];
                    } else if (data.url) {
                        return data.url;
                    } else {
                        throw new Error('No image URL in response');
                    }
                } catch (error) {
                    console.error('Generation error:', error);
                    this.showNotification('⏱️ Switching to backup engine...', 'error');
                    return await this.generatePollinationsImage(prompt);
                }
            }

            async generatePollinationsImage(prompt) {
                const encodedPrompt = encodeURIComponent(prompt);
                const size = this.sizeSelect.value;
                const width = size.includes('x') ? size.split('x')[0] : size;
                const height = size.includes('x') ? size.split('x')[1] : size;
                const seed = Math.floor(Math.random() * 1000000);
                
                return `https://image.pollinations.ai/prompt/${encodedPrompt}?width=${width}&height=${height}&seed=${seed}`;
            }

            async searchPixabayImage(prompt) {
                const apiKey = this.apiKeys.pixabay;
                const keywords = prompt.split(' ').slice(0, 5).join('+');
                const url = `https://pixabay.com/api/?key=${apiKey}&q=${encodeURIComponent(keywords)}&image_type=photo&pretty=true&min_width=1024&min_height=768&per_page=20`;
                
                try {
                    const response = await fetch(url);
                    const data = await response.json();
                    
                    if (data.hits && data.hits.length > 0) {
                        const randomImage = data.hits[Math.floor(Math.random() * data.hits.length)];
                        return randomImage.largeImageURL || randomImage.webformatURL;
                    } else {
                        throw new Error('No images found');
                    }
                } catch (error) {
                    return await this.generatePollinationsImage(prompt);
                }
            }

            async searchUnsplashImage(prompt) {
                const accessKey = this.apiKeys.unsplash;
                const keywords = prompt.split(' ').slice(0, 3).join(' ');
                const url = `https://api.unsplash.com/search/photos?query=${encodeURIComponent(keywords)}&client_id=${accessKey}&per_page=30`;
                
                try {
                    const response = await fetch(url);
                    const data = await response.json();
                    
                    if (data.results && data.results.length > 0) {
                        const randomImage = data.results[Math.floor(Math.random() * data.results.length)];
                        return randomImage.urls.regular;
                    } else {
                        throw new Error('No images found');
                    }
                } catch (error) {
                    return await this.generatePollinationsImage(prompt);
                }
            }

            displayGeneratedImage(imageUrl, prompt) {
                this.generatedImage.src = imageUrl;
                this.generatedImage.alt = prompt;
                this.usedPrompt.textContent = prompt;
                this.usedQuality.textContent = this.getQualityDisplayName();
                
                this.hideElements();
                this.imageContainer.style.display = 'block';
                
                this.currentImageData = { 
                    url: imageUrl, 
                    prompt: prompt, 
                    quality: this.selectedQuality,
                    style: this.styleSelect.value,
                    size: this.sizeSelect.value,
                    timestamp: new Date().toISOString()
                };
            }

            getQualityDisplayName() {
                const qualityNames = {
                    ultra: '🚀 Quantum Quality',
                    pro: '💎 Neural Quality',
                    premium: '⭐ Premium Quality',
                    standard: '🎨 Standard Quality'
                };
                return qualityNames[this.selectedQuality] || 'Unknown';
            }

            // Image Actions
            async downloadImage() {
                if (!this.currentImageData) return;
                
                try {
                    const response = await fetch(this.currentImageData.url, {
                        mode: 'cors'
                    });
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `quantum-ai-generated-${Date.now()}.png`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);
                    
                    this.showNotification('💾 Image saved successfully!', 'success');
                } catch (error) {
                    console.error('Download error:', error);
                    this.showNotification('❌ Download failed. Try right-clicking and "Save As"', 'error');
                }
            }

            showFullscreen() {
                if (!this.currentImageData) return;
                
                this.modalImage.src = this.currentImageData.url;
                this.imageModal.style.display = 'flex';
                document.body.style.overflow = 'hidden';
            }

            hideModal() {
                this.imageModal.style.display = 'none';
                document.body.style.overflow = 'auto';
            }

            async regenerateImage() {
                if (!this.currentImageData) return;
                
                this.promptInput.value = this.currentImageData.prompt;
                this.updateCharCount();
                await this.generateImage();
            }

            async shareImage() {
                if (!this.currentImageData) return;
                
                if (navigator.share) {
                    try {
                        await navigator.share({
                            title: 'My Quantum AI Generated Image',
                            text: `Check out this AI-generated image: "${this.currentImageData.prompt}" - Created with Quantum AI Assistant`,
                            url: this.currentImageData.url
                        });
                        this.showNotification('📤 Image shared successfully!', 'success');
                    } catch (error) {
                        this.copyToClipboard();
                    }
                } else {
                    this.copyToClipboard();
                }
            }

            async copyToClipboard() {
                try {
                    await navigator.clipboard.writeText(this.currentImageData.url);
                    this.showNotification('📋 Image URL copied to clipboard!', 'success');
                } catch (error) {
                    this.showNotification('❌ Sharing not supported. Right-click image to copy.', 'error');
                }
            }

            // AI Chat API
            async getApiResponse(userMessage) {
                const apiUrl = 'https://openrouter.ai/api/v1/chat/completions';
                const apiKey = "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";

                // Basic check if placeholder values are still there
                if (apiUrl === 'YOUR_AI_API_ENDPOINT' || apiKey === 'Y') {
                    console.error("API Endpoint or Key not configured!");
                    this.addMessage("I'm sorry, but I'm not configured to answer questions right now. Please check the API configuration.", 'ai');
                    this.removeTypingIndicator();
                    return;
                }

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${apiKey}`
                        },
                        body: JSON.stringify({
                            model: "gpt-3.5-turbo",
                            messages: [{ role: "user", content: userMessage }],
                            max_tokens: 150
                        })
                    });

                    if (!response.ok) {
                        const errorData = await response.json().catch(() => null);
                        const errorText = errorData?.error?.message || `HTTP Error: ${response.status} ${response.statusText}`;
                        throw new Error(errorText);
                    }

                    const data = await response.json();
                    let aiText = "I'm sorry, I couldn't process your request at the moment.";

                    if (data.choices && data.choices[0] && data.choices[0].message) {
                        aiText = data.choices[0].message.content.trim();
                    }

                    this.addMessage(aiText, 'ai');

                } catch (error) {
                    console.error("Error fetching AI response:", error);
                    this.removeTypingIndicator();
                    this.addMessage(`I'm sorry, there was an error connecting to the AI service: ${error.message}`, 'ai');
                }
            }

            // UI Helper Methods
            setLoadingState(loading) {
                this.generateBtn.disabled = loading;
                if (loading) {
                    this.generateBtn.innerHTML = '<span><i class="fas fa-spinner fa-spin"></i> Quantum Creating...</span>';
                } else {
                    this.generateBtn.innerHTML = '<span><i class="fas fa-magic"></i> Generate Image</span>';
                }
            }

            hideElements() {
                this.placeholder.style.display = 'none';
                this.imageContainer.style.display = 'none';
                this.loadingContainer.style.display = 'none';
            }

            showPlaceholder() {
                this.hideElements();
                this.placeholder.style.display = 'block';
            }

            showNotification(message, type = 'success') {
                this.notificationText.textContent = message;
                this.notification.className = `notification ${type}`;
                this.notification.style.display = 'block';
                
                setTimeout(() => {
                    this.hideNotification();
                }, 4000);
            }

            hideNotification() {
                this.notification.style.display = 'none';
            }

            // Background Animation
            createParticles() {
                const particlesContainer = document.getElementById('particles');
                const particleCount = 50;
                
                for (let i = 0; i < particleCount; i++) {
                    const particle = document.createElement('div');
                    particle.classList.add('particle');
                    
                    // Random size
                    const size = Math.random() * 5 + 2;
                    particle.style.width = `${size}px`;
                    particle.style.height = `${size}px`;
                    
                    // Random position
                    particle.style.left = `${Math.random() * 100}%`;
                    particle.style.top = `${Math.random() * 100}%`;
                    
                    // Random animation delay and duration
                    particle.style.animationDelay = `${Math.random() * 20}s`;
                    particle.style.animationDuration = `${Math.random() * 10 + 15}s`;
                    
                    particlesContainer.appendChild(particle);
                }
            }

            showWelcomeMessage() {
                setTimeout(() => {
                    this.showNotification('🚀 Welcome to Quantum AI Assistant! Experience next-gen chat and image generation.', 'success');
                }, 1000);
            }
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            new AIAssistant();
        });
    </script>
</body>
</html>
